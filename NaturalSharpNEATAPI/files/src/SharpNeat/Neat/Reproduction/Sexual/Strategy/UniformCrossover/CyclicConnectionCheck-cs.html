<!DOCTYPE html>

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>CyclicConnectionCheck.cs</title><link rel="stylesheet" type="text/css" href="../../../../../../../../styles/main.css" /><script type="text/javascript" src="../../../../../../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../../../../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Variables"></a><a name="Topic1559"></a><div class="CTopic TGroup LCSharp first">
 <div class="CTitle">Variables</div>
</div>

<a name="SharpNeat.Neat.Reproduction.Sexual.Strategy.UniformCrossover"></a><a name="Topic1560"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle"><span class="Qualifier">SharpNeat.&#8203;Neat.&#8203;Reproduction.&#8203;Sexual.&#8203;Strategy.</span>&#8203;UniformCrossover</div>
 <div id="NDPrototype1560" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">namespace</span> SharpNeat.Neat.Reproduction.Sexual.Strategy.UniformCrossover</div></div>
</div>

<a name="CyclicConnectionCheck"></a><a name="Topic1561"></a><div class="CTopic TClass LCSharp">
 <div class="CTitle">CyclicConnectionCheck</div>
 <div class="NDClassPrototype" id="NDClassPrototype1561"><div class="CPEntry TClass Current"><div class="CPModifiers"><span class="SHKeyword">public sealed</span></div><div class="CPName">CyclicConnectionCheck</div></div></div>
 <div class="CBody"><p>For checking/testing if a proposed new connection on a NEAT genome would form a connectivity cycle.</p><p>This class utilises a depth first graph traversal algorithm to check if a proposed new connection on a given graph would form a cycle, as such it is assumed that the graph as given is acyclic, if it isn't then the graph traversal stack will grown to infinity, ultimately resulting in an OutOfMemory exception.&nbsp; The algorithm will perform a full depth first traversal of the graph starting at the proposed new connection's target node, and if that connection's source node is encountered then it would form a cycle if it were added to the graph.&nbsp; Each instance of this class allocates a stack and a hashset for use by the traversal algorithm, and these are cleared and re-used for each call to IsConnectionCyclic(). This avoids memory re-allocation and garbage collection overhead, but the side effect is that IsConnectionCyclic() is not reentrant, i.e. can only be in use by one execution thread at a given point in time. A reentrancy check will throw an exception if reentrancy is attempted.&nbsp; Implementation Details / Notes ---------------------- This class is optimized for speed and efficiency and as such is tightly coupled with the connection gene list data structure, and is perhaps not as easy to read/understand as a traditional depth first graph traversal algorithm using function recursion. However this is essentially a depth first graph traversal algorithm that utilises its own stack instead of using the call stack.&nbsp; The traversal stack is a stack of Int32(s), each of which is an index into connList (the list of connections that make up the graph, ordered by sourceId and then targetId). Thus, each stack entry points to a connection, and represents traversal of that connection's source node and also which of that node's child connections/nodes is the current traversal position/path from that node (note. this works because the connections are sorted by sourceId first).&nbsp; As such this algorithm has a far more compact stack frame than the equivalent algorithm implemented as a recursive function, and avoids any other method call overhead as a further performance benefit (i.e. overhead other than stack frame initialisation).&nbsp; The main optimizations then are:&nbsp; * No method call overhead from recursive method calls.&nbsp; * Each stack frame is a single int32 and thus the stack as a whole is highly compact; this improves CPU cache locality and hit rate, and also keeps the max size of the stack for any given traversal at a minimum.&nbsp; * The stack and a visitedNodes HashSet are allocated for each class instance and are cleared and re-used for each call to IsConnectionCyclic(), therefore minimizing memory allocation and garbage collection overhead.&nbsp; * Using a stack on the heap also avoids any potential for a stack overflow on very deep graphs, which could occur if using method call recursion.&nbsp; Problems with the approach of this class are:&nbsp; * The code is more complex than the same algorithm written as a recursive function; this makes the code harder to read, understand and maintain, thus increasing the probability of subtle defects.&nbsp; Also see: Graphs.Acyclic.CyclicConnectionCheck Graphs.Acyclic.AcyclicGraphDepthAnalysis <a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/CyclicGraphCheck.cs:CyclicGraphCheck" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,877);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >CyclicGraphCheck</a>.</p></div>
</div>

<a name="CyclicConnectionCheck.Variables"></a><a name="Topic1562"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Variables</div>
</div>

<a name="CyclicConnectionCheck._traversalStack"></a><a name="Topic1563"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_traversalStack</div>
 <div id="NDPrototype1563" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> IntStack _traversalStack</div></div>
</div>

<a name="CyclicConnectionCheck._visitedNodes"></a><a name="Topic1564"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_visitedNodes</div>
 <div id="NDPrototype1564" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> HashSet&lt;<span class="SHKeyword">int</span>&gt; _visitedNodes</div></div>
</div>

<a name="CyclicConnectionCheck._reentranceFlag"></a><a name="Topic1565"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_reentranceFlag</div>
 <div id="NDPrototype1565" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">int</span> _reentranceFlag</div></div>
</div>

<a name="CyclicConnectionCheck.Functions"></a><a name="Topic1566"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Functions</div>
</div>

<a name="CyclicConnectionCheck.IsConnectionCyclic"></a><a name="Topic1567"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">IsConnectionCyclic</div>
 <div id="NDPrototype1567" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">bool</span> IsConnectionCyclic(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="first"></td><td class="PType">Span&lt;<a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&gt;&nbsp;</td><td class="PName last">connSpan,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">in</span>&nbsp;</td><td class="PType"><a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&nbsp;</td><td class="PName last">newConn</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Tests if the proposed new connection newConn would form a cycle if added to the existing directed acyclic graph described by connArr.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">connSpan<div class="CDLParameterType">Span&lt;<a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&gt;</div></td><td class="CDLDefinition"><p>A set of connections that describe a directed acyclic graph.</p></td></tr><tr><td class="CDLEntry">newConn<div class="CDLParameterType"><span class="SHKeyword">in</span> <a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a></div></td><td class="CDLDefinition"><p>A proposed new connection to add to the graph.</p></td></tr></table><div class="CHeading">Returns</div><p>True if newConn would form a cycle; otherwise false.</p></div>
</div>

<a name="CyclicConnectionCheck.IsConnectionCyclicInner"></a><a name="Topic1568"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">IsConnectionCyclicInner</div>
 <div id="NDPrototype1568" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private</span> <span class="SHKeyword">bool</span> IsConnectionCyclicInner(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="first"></td><td class="PType">Span&lt;<a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&gt;&nbsp;</td><td class="PName last">connSpan,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">in</span>&nbsp;</td><td class="PType"><a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&nbsp;</td><td class="PName last">newConn</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
</div>

<a name="CyclicConnectionCheck.Cleanup"></a><a name="Topic1569"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">Cleanup</div>
 <div id="NDPrototype1569" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">private</span> <span class="SHKeyword">void</span> Cleanup()</div></div>
</div>

<a name="CyclicConnectionCheck.InitGraphTraversal"></a><a name="Topic1570"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">InitGraphTraversal</div>
 <div id="NDPrototype1570" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private</span> <span class="SHKeyword">void</span> InitGraphTraversal(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">startNodeId,</td></tr><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">connIdx</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
</div>

<a name="CyclicConnectionCheck.TraverseGraph"></a><a name="Topic1571"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">TraverseGraph</div>
 <div id="NDPrototype1571" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private</span> <span class="SHKeyword">bool</span> TraverseGraph(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">Span&lt;<a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&gt;&nbsp;</td><td class="PName last">connSpan,</td></tr><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">terminalNodeId</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>The graph traversal algorithm.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">connSpan<div class="CDLParameterType">Span&lt;<a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&gt;</div></td><td class="CDLDefinition"><p>A set of connections that represents the graph to traverse.</p></td></tr><tr><td class="CDLEntry">terminalNodeId<div class="CDLParameterType"><span class="SHKeyword">int</span></div></td><td class="CDLDefinition"><p>// The 'terminal' node ID, i.e. if traversal reaches this node then newConn would form a cycle and we stop/terminate traversal.</p></td></tr></table></div>
</div>

<a name="CyclicConnectionCheck.MoveForward"></a><a name="Topic1572"></a><div class="CTopic TFunction LCSharp last">
 <div class="CTitle">MoveForward</div>
 <div id="NDPrototype1572" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private</span> <span class="SHKeyword">void</span> MoveForward(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">Span&lt;<a href="../../../../../../../../index.html#File:src/SharpNeat/Graphs/DirectedConnection.cs:DirectedConnection" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,828);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >DirectedConnection</a>&gt;&nbsp;</td><td class="PName last">connSpan,</td></tr><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">currConnIdx</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Update the stack state to point to the next connection to traverse down.</p></div>
</div>

</body></html>