<!DOCTYPE html>

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>CartSinglePolePhysicsRK4</title><link rel="stylesheet" type="text/css" href="../../styles/main.css" /><script type="text/javascript" src="../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Topic2674"></a><div class="CTopic TClass LCSharp first">
 <div class="CTitle">CartSinglePolePhysicsRK4</div>
 <div class="NDClassPrototype" id="NDClassPrototype2674"><div class="CPEntry TClass Current"><div class="CPModifiers"><span class="SHKeyword">public sealed</span></div><div class="CPName">CartSinglePolePhysicsRK4</div></div></div>
 <div class="CBody"><p>Represents the cart-pole physical model (with a single pole); providing a model state update method that employs a classic 4th order Runge-Kutta to project to the state at the next timestep.</p><p>This cart-pole physics code is based on code from <a href="https://github.com/colgreen/cartpole-physics" target="_top">https://&#8203;github&#8203;.com&#8203;/colgreen&#8203;/cartpole-physics</a> which in turn is based on the cart-pole equations from this paper: &quot;Equations of Motion for the Cart and Pole Control Task&quot; <a href="https://sharpneat.sourceforge.io/research/cart-pole/cart-pole-equations.html" target="_top">https://&#8203;sharpneat&#8203;.sourceforge&#8203;.io&#8203;/research&#8203;/cart-pole&#8203;/cart-pole-equations&#8203;.html</a>.</p></div>
</div>

<a name="Constants"></a><a name="Topic2675"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Constants</div>
</div>

<a name="g"></a><a name="Topic2676"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">g</div>
 <div id="NDPrototype2676" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> g</div></div>
 <div class="CBody"><p>Gravitational acceleration (in m/s^2). Here g is taken to be the directionless magnitude of the acceleration caused by gravity (i.e. approximately 9.8 m/s^2 for gravity on Earth). The direction of gravitational acceleration is taken into account in the formulation of the equations, therefore the sign of g is positive.</p></div>
</div>

<a name="m"></a><a name="Topic2677"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">m</div>
 <div id="NDPrototype2677" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> m</div></div>
 <div class="CBody"><p>Mass of the pole (in kilograms).</p></div>
</div>

<a name="m_c"></a><a name="Topic2678"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">m_c</div>
 <div id="NDPrototype2678" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> m_c</div></div>
 <div class="CBody"><p>Mass of the cart (in kilograms).</p></div>
</div>

<a name="l"></a><a name="Topic2679"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">l</div>
 <div id="NDPrototype2679" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> l</div></div>
 <div class="CBody"><p>Length of the pole (in metres). This is the full length of the pole, and not the half length as used widely elsewhere in the literature.</p></div>
</div>

<a name="l_hat"></a><a name="Topic2680"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">l_hat</div>
 <div id="NDPrototype2680" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> l_hat</div></div>
 <div class="CBody"><p>Half of the pole's length.</p></div>
</div>

<a name="mu_p"></a><a name="Topic2681"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">mu_p</div>
 <div id="NDPrototype2681" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> mu_p</div></div>
 <div class="CBody"><p>Coefficient of friction between the pole and the cart, i.e. friction at the pole's pivot joint.</p></div>
</div>

<a name="mu_c"></a><a name="Topic2682"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">mu_c</div>
 <div id="NDPrototype2682" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> mu_c</div></div>
 <div class="CBody"><p>Coefficient of friction between the cart and the track.</p></div>
</div>

<a name="M"></a><a name="Topic2683"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">M</div>
 <div id="NDPrototype2683" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> M</div></div>
 <div class="CBody"><p>Combined mass of the cart and the pole.</p></div>
</div>

<a name="tau"></a><a name="Topic2684"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">tau</div>
 <div id="NDPrototype2684" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> tau</div></div>
 <div class="CBody"><p>The timestep increment, e.g. 0.01 for 10 millisecond increments.</p></div>
</div>

<a name="tau_half"></a><a name="Topic2685"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">tau_half</div>
 <div id="NDPrototype2685" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> tau_half</div></div>
</div>

<a name="Variables"></a><a name="Topic2686"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Variables</div>
</div>

<a name="_state"></a><a name="Topic2687"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_state</div>
 <div id="NDPrototype2687" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _state</div></div>
 <div class="CBody"><p>The model state variables are: [0] x-axis coordinate of the cart (metres).&nbsp; [1] x-axis velocity of the cart (m/s).&nbsp; [2] Pole angle (radians); deviation from the vertical. Positive is clockwise.&nbsp; [3] Pole angular velocity (radians/s). Positive is clockwise.</p></div>
</div>

<a name="_k1"></a><a name="Topic2688"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k1</div>
 <div id="NDPrototype2688" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k1</div></div>
</div>

<a name="_k2"></a><a name="Topic2689"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k2</div>
 <div id="NDPrototype2689" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k2</div></div>
</div>

<a name="_k3"></a><a name="Topic2690"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k3</div>
 <div id="NDPrototype2690" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k3</div></div>
</div>

<a name="_k4"></a><a name="Topic2691"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k4</div>
 <div id="NDPrototype2691" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k4</div></div>
</div>

<a name="_s"></a><a name="Topic2692"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_s</div>
 <div id="NDPrototype2692" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _s</div></div>
</div>

<a name="Properties"></a><a name="Topic2693"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Properties</div>
</div>

<a name="State"></a><a name="Topic2694"></a><div class="CTopic TProperty LCSharp">
 <div class="CTitle">State</div>
 <div id="NDPrototype2694" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">public</span> <span class="SHKeyword">float</span>[] State { <span class="SHKeyword">get</span> }</div></div>
 <div class="CBody"><p>Get the cart-pole model state.</p><p>The model state variables are: [0] x-axis coordinate of the cart (metres).&nbsp; [1] x-axis velocity of the cart (m/s).&nbsp; [2] Pole angle (radians); deviation from the vertical. Positive is clockwise.&nbsp; [3] Pole angular velocity (radians/s). Positive is clockwise.</p></div>
</div>

<a name="Functions"></a><a name="Topic2695"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Functions</div>
</div>

<a name="ResetState"></a><a name="Topic2696"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">ResetState</div>
 <div id="NDPrototype2696" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">void</span> ResetState(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">cartPos,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">poleAngle</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Reset model state.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">cartPos<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Cart position on the track.</p></td></tr><tr><td class="CDLEntry">poleAngle<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Pole angle in radians.</p></td></tr></table></div>
</div>

<a name="Update"></a><a name="Topic2697"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">Update</div>
 <div id="NDPrototype2697" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">void</span> Update(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">f</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Update the model state. I.e. move the state forward by one timestep.</p><p>This implementation of Update() uses classic 4th order Runge-Kutta;&nbsp; this is considerably more accurate that Euler's method or 2nd order Runge-Kutta for a given timestep size.</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">f<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>The external horizontal force applied to the cart.</p></td></tr></table></div>
</div>

<a name="CalcAccelerations"></a><a name="Topic2698"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">CalcAccelerations</div>
 <div id="NDPrototype2698" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private static</span> <span class="SHKeyword">void</span> CalcAccelerations(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="first"></td><td class="PType"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">state,</td></tr><tr><td class="first"></td><td class="PType"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">f,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">out</span>&nbsp;</td><td class="PType"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">xa,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">out</span>&nbsp;</td><td class="PType"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">thetaa</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Calculate cart acceleration, and pole angular acceleration for a given model state and external horizontal force applied to the cart.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">state<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>The cart-pole model state.</p></td></tr><tr><td class="CDLEntry">f<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>The external horizontal force applied to the cart.</p></td></tr><tr><td class="CDLEntry">xa<div class="CDLParameterType"><span class="SHKeyword">out</span> <span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Returns the cart's horizontal acceleration.</p></td></tr><tr><td class="CDLEntry">thetaa<div class="CDLParameterType"><span class="SHKeyword">out</span> <span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Returns the pole's angular acceleration.</p></td></tr></table></div>
</div>

<a name="MultiplyAdd"></a><a name="Topic2699"></a><div class="CTopic TFunction LCSharp last">
 <div class="CTitle">MultiplyAdd</div>
 <div id="NDPrototype2699" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private static</span> <span class="SHKeyword">void</span> MultiplyAdd(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">dest,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">add,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">a,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">scalar</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Fused multiply-add.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dest<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>Destination array. The results are stored in this array.</p></td></tr><tr><td class="CDLEntry">add<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>The elements in this array are pointwise added to the destination array.</p></td></tr><tr><td class="CDLEntry">a<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>An array to multiply by a scalar.</p></td></tr><tr><td class="CDLEntry">scalar<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>A scalar to multiply array a by.</p></td></tr></table></div>
</div>

</body></html>