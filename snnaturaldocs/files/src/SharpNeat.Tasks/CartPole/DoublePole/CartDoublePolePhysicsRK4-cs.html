<!DOCTYPE html>

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>CartDoublePolePhysicsRK4.cs</title><link rel="stylesheet" type="text/css" href="../../../../../styles/main.css" /><script type="text/javascript" src="../../../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Variables"></a><a name="Topic2600"></a><div class="CTopic TGroup LCSharp first">
 <div class="CTitle">Variables</div>
</div>

<a name="SharpNeat.Tasks.CartPole.DoublePole"></a><a name="Topic2601"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle"><span class="Qualifier">SharpNeat.&#8203;Tasks.&#8203;CartPole.</span>&#8203;DoublePole</div>
 <div id="NDPrototype2601" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">namespace</span> SharpNeat.Tasks.CartPole.DoublePole</div></div>
</div>

<a name="CartDoublePolePhysicsRK4"></a><a name="Topic2602"></a><div class="CTopic TClass LCSharp">
 <div class="CTitle">CartDoublePolePhysicsRK4</div>
 <div class="NDClassPrototype" id="NDClassPrototype2602"><div class="CPEntry TClass Current"><div class="CPModifiers"><span class="SHKeyword">public sealed</span></div><div class="CPName">CartDoublePolePhysicsRK4</div></div></div>
 <div class="CBody"><p>Represents the cart-pole physical model (with two poles); providing a model state update method that employs a classic 4th order Runge-Kutta to project to the state at the next timestep.</p><p>This cart-pole physics code is based on code from <a href="https://github.com/colgreen/cartpole-physics" target="_top">https://&#8203;github&#8203;.com&#8203;/colgreen&#8203;/cartpole-physics</a> which in turn is based on the cart-pole equations from this paper: &quot;Equations of Motion for the Cart and Pole Control Task&quot; <a href="https://sharpneat.sourceforge.io/research/cart-pole/cart-pole-equations.html" target="_top">https://&#8203;sharpneat&#8203;.sourceforge&#8203;.io&#8203;/research&#8203;/cart-pole&#8203;/cart-pole-equations&#8203;.html</a>.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.Constants"></a><a name="Topic2603"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Constants</div>
</div>

<a name="CartDoublePolePhysicsRK4.g"></a><a name="Topic2604"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">g</div>
 <div id="NDPrototype2604" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> g</div></div>
 <div class="CBody"><p>Gravitational acceleration (in m/s^2). Here g is taken to be the directionless magnitude of the acceleration caused by gravity (i.e. approximately 9.8 m/s^2 for gravity on Earth). The direction of gravitational acceleration is taken into account in the formulation of the equations, therefore the sign of g is positive.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.m"></a><a name="Topic2605"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">m</div>
 <div id="NDPrototype2605" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> m</div></div>
 <div class="CBody"><p>Mass of pole 1 (in kilograms).</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.m2"></a><a name="Topic2606"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">m2</div>
 <div id="NDPrototype2606" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> m2</div></div>
 <div class="CBody"><p>Mass of pole 2 (in kilograms).</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.m_c"></a><a name="Topic2607"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">m_c</div>
 <div id="NDPrototype2607" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> m_c</div></div>
 <div class="CBody"><p>Mass of the cart (in kilograms).</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.l"></a><a name="Topic2608"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">l</div>
 <div id="NDPrototype2608" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> l</div></div>
 <div class="CBody"><p>Length of pole 1 (in metres). This is the full length of the pole, and not the half length as used widely elsewhere in the literature.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.l_hat"></a><a name="Topic2609"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">l_hat</div>
 <div id="NDPrototype2609" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> l_hat</div></div>
 <div class="CBody"><p>Half length of pole 1.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.l2"></a><a name="Topic2610"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">l2</div>
 <div id="NDPrototype2610" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> l2</div></div>
 <div class="CBody"><p>Length of pole 2 (in metres). This is the full length of the pole, and not the half length as used widely elsewhere in the literature.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.l2_hat"></a><a name="Topic2611"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">l2_hat</div>
 <div id="NDPrototype2611" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> l2_hat</div></div>
 <div class="CBody"><p>Half length of pole 2.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.mu_p"></a><a name="Topic2612"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">mu_p</div>
 <div id="NDPrototype2612" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> mu_p</div></div>
 <div class="CBody"><p>Coefficient of friction between the pole and the cart, i.e. friction at the pole's pivot joint.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.mu_c"></a><a name="Topic2613"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">mu_c</div>
 <div id="NDPrototype2613" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> mu_c</div></div>
 <div class="CBody"><p>Coefficient of friction between the cart and the track.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.M"></a><a name="Topic2614"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">M</div>
 <div id="NDPrototype2614" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> M</div></div>
 <div class="CBody"><p>Combined mass of the cart and the two poles.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.tau"></a><a name="Topic2615"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">tau</div>
 <div id="NDPrototype2615" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> tau</div></div>
 <div class="CBody"><p>The timestep increment, e.g. 0.01 for 10 millisecond increments.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.tau_half"></a><a name="Topic2616"></a><div class="CTopic TConstant LCSharp">
 <div class="CTitle">tau_half</div>
 <div id="NDPrototype2616" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">const</span> <span class="SHKeyword">float</span> tau_half</div></div>
</div>

<a name="CartDoublePolePhysicsRK4.Variables"></a><a name="Topic2617"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Variables</div>
</div>

<a name="CartDoublePolePhysicsRK4._state"></a><a name="Topic2618"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_state</div>
 <div id="NDPrototype2618" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _state</div></div>
 <div class="CBody"><p>The model state variables are: [0] x-axis coordinate of the cart (metres).&nbsp; [1] x-axis velocity of the cart (m/s).&nbsp; [2] Pole 1 angle (radians); deviation from the vertical. Positive is clockwise.&nbsp; [3] Pole 1 angular velocity (radians/s). Positive is clockwise.&nbsp; [4] Pole 2 angle (radians); deviation from the vertical. Positive is clockwise.&nbsp; [5] Pole 2 angular velocity (radians/s). Positive is clockwise.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4._k1"></a><a name="Topic2619"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k1</div>
 <div id="NDPrototype2619" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k1</div></div>
</div>

<a name="CartDoublePolePhysicsRK4._k2"></a><a name="Topic2620"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k2</div>
 <div id="NDPrototype2620" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k2</div></div>
</div>

<a name="CartDoublePolePhysicsRK4._k3"></a><a name="Topic2621"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k3</div>
 <div id="NDPrototype2621" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k3</div></div>
</div>

<a name="CartDoublePolePhysicsRK4._k4"></a><a name="Topic2622"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_k4</div>
 <div id="NDPrototype2622" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _k4</div></div>
</div>

<a name="CartDoublePolePhysicsRK4._s"></a><a name="Topic2623"></a><div class="CTopic TVariable LCSharp">
 <div class="CTitle">_s</div>
 <div id="NDPrototype2623" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">readonly</span> <span class="SHKeyword">float</span>[] _s</div></div>
</div>

<a name="CartDoublePolePhysicsRK4.Properties"></a><a name="Topic2624"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Properties</div>
</div>

<a name="CartDoublePolePhysicsRK4.State"></a><a name="Topic2625"></a><div class="CTopic TProperty LCSharp">
 <div class="CTitle">State</div>
 <div id="NDPrototype2625" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">public</span> <span class="SHKeyword">float</span>[] State { <span class="SHKeyword">get</span> }</div></div>
 <div class="CBody"><p>Get the cart-pole model state.</p><p>The model state variables are: [0] x-axis coordinate of the cart (metres).&nbsp; [1] x-axis velocity of the cart (m/s).&nbsp; [2] Pole 1 angle (radians); deviation from the vertical. Positive is clockwise.&nbsp; [3] Pole 1 angular velocity (radians/s). Positive is clockwise.&nbsp; [4] Pole 2 angle (radians); deviation from the vertical. Positive is clockwise.&nbsp; [5] Pole 2 angular velocity (radians/s). Positive is clockwise.</p></div>
</div>

<a name="CartDoublePolePhysicsRK4.Functions"></a><a name="Topic2626"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Functions</div>
</div>

<a name="CartDoublePolePhysicsRK4.ResetState"></a><a name="Topic2627"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">ResetState</div>
 <div id="NDPrototype2627" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">void</span> ResetState(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">cartPos,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">poleAngle1,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">poleAngle2</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Reset model state.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">cartPos<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Cart position on the track.</p></td></tr><tr><td class="CDLEntry">poleAngle1<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Pole 1 angle in radians.</p></td></tr><tr><td class="CDLEntry">poleAngle2<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Pole 2 angle in radians.</p></td></tr></table></div>
</div>

<a name="CartDoublePolePhysicsRK4.Update"></a><a name="Topic2628"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">Update</div>
 <div id="NDPrototype2628" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">void</span> Update(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">f</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Update the model state. I.e. move the state forward by one timestep.</p><p>This implementation of Update() uses classic 4th order Runge-Kutta;&nbsp; this is considerably more accurate that Euler's method or 2nd order Runge-Kutta for a given timestep size.</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">f<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>The external horizontal force applied to the cart.</p></td></tr></table></div>
</div>

<a name="CartDoublePolePhysicsRK4.CalcAccelerations"></a><a name="Topic2629"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">CalcAccelerations</div>
 <div id="NDPrototype2629" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private static</span> <span class="SHKeyword">void</span> CalcAccelerations(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="first"></td><td class="PType"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">state,</td></tr><tr><td class="first"></td><td class="PType"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">f,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">out</span>&nbsp;</td><td class="PType"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">xa,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">out</span>&nbsp;</td><td class="PType"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">thetaa1,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">out</span>&nbsp;</td><td class="PType"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">thetaa2</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Calculate cart acceleration, and pole angular acceleration for a given model state and external horizontal force applied to the cart.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">state<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>The cart-pole model state. The model state variables are: [0] x-axis coordinate of the cart (metres).&nbsp; [1] x-axis velocity of the cart (m/s).&nbsp; [2] Pole 1 angle (radians). Clockwise deviation from the vertical.&nbsp; [3] Pole 1 angular velocity (radians/s). Positive is clockwise.&nbsp; [4] Pole 2 angle (radians). Clockwise deviation from the vertical.&nbsp; [5] Pole 2 angular velocity (radians/s). Positive is clockwise.</p></td></tr><tr><td class="CDLEntry">f<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>The external horizontal force applied to the cart.</p></td></tr><tr><td class="CDLEntry">xa<div class="CDLParameterType"><span class="SHKeyword">out</span> <span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Returns the cart's horizontal acceleration.</p></td></tr><tr><td class="CDLEntry">thetaa1<div class="CDLParameterType"><span class="SHKeyword">out</span> <span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Returns pole 1's angular acceleration.</p></td></tr><tr><td class="CDLEntry">thetaa2<div class="CDLParameterType"><span class="SHKeyword">out</span> <span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>Returns pole 2's angular acceleration.</p></td></tr></table></div>
</div>

<a name="CartDoublePolePhysicsRK4.MultiplyAdd"></a><a name="Topic2630"></a><div class="CTopic TFunction LCSharp last">
 <div class="CTitle">MultiplyAdd</div>
 <div id="NDPrototype2630" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">private static</span> <span class="SHKeyword">void</span> MultiplyAdd(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">dest,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">add,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>[]&nbsp;</td><td class="PName last">a,</td></tr><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">scalar</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Fused multiply-add.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">dest<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>Destination array. The results are stored in this array.</p></td></tr><tr><td class="CDLEntry">add<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>The elements in this array are pointwise added to the destination array.</p></td></tr><tr><td class="CDLEntry">a<div class="CDLParameterType"><span class="SHKeyword">float</span>[]</div></td><td class="CDLDefinition"><p>An array to multiply by a scalar.</p></td></tr><tr><td class="CDLEntry">scalar<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>A scalar to multiply array a by.</p></td></tr></table></div>
</div>

</body></html>